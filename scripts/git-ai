#!/usr/bin/env bash
set -euo pipefail

tmp=$(mktemp)
trap 'rm -f "$tmp"' EXIT

git_ai_cmd=(git-cc-ai "$@")
if [[ -n "${GIT_AI_BACKEND:-}" ]]; then
  git_ai_cmd=(env "GIT_AI_BACKEND=$GIT_AI_BACKEND" git-cc-ai "$@")
fi

{ "${git_ai_cmd[@]}" | git commit -F - --edit; } 2> "$tmp"
ret=$?
cat "$tmp" >&2
exit $ret
